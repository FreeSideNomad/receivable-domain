# Domain Model Discovery Questions

**Purpose**: Clarify domain boundaries, bounded contexts, and relationships for the Payment Receivables Platform

---

## Section 1: Strategic Domain Questions

### A. Domain Classification

Based on the vision, I'm seeing these potential domains:

1. **Receivables Management** (Core Domain?)
   - Invoice creation, approval workflows, payment collection
   - This is where your competitive advantage lies

2. **Identity & Access Management** (Generic Domain?)
   - User authentication (Okta), permissions, roles
   - Could this be outsourced/off-the-shelf?

3. **Payment Processing** (Supporting or Core?)
   - ACH file generation, payment submission, returns handling
   - Is this differentiating or commodity?

4. **Payor Relationship Management** (Supporting?)
   - Onboarding payors, managing payor profiles
   - Necessary but perhaps not differentiating?

5. **Banking Integration** (Supporting?)
   - Integration with existing online banking
   - Account management

**Questions:**

**Q1.1**: Do you agree with this domain breakdown? Which domain is the **core domain** where you want to invest the most?

**Q1.2**: Is **Payment Processing** differentiating for you, or is it commodity (ACH is standard)? This affects whether it's core or supporting.

**Q1.3**: Should **Invoice Generation** (PDF templates) be its own domain, or is it part of Receivables Management?

**Q1.4**: The **existing online banking system** - is that a separate bounded context we integrate with via ACL (Anti-Corruption Layer)?

---

### B. Bounded Context Identification

Within the domains, I'm seeing these potential bounded contexts:

**Receivables Context**:
- Terms: Invoice, Receivable Customer, Approval Status, Due Date
- Responsible for: Invoice lifecycle from creation to approved

**Payment Context**:
- Terms: Payment, ACH File, Payment Status, Return, Debit Account
- Responsible for: Payment execution and settlement

**Payor Context**:
- Terms: Payor, Payor Profile, Bank Account, Relationship
- Responsible for: Payor organization and account management

**Approval & Workflow Context**:
- Terms: Approval Rule, Approval Tier, Approver, Approval Chain
- Responsible for: Configurable approval workflows

**Identity & Access Context**:
- Terms: User, Role, Permission, Authentication
- Responsible for: Who can do what

**Questions:**

**Q2.1**: Does the word "Invoice" mean the same thing in all parts of the system? Or does it mean:
- In Receivables Context: "Document awaiting approval"
- In Payment Context: "Approved item to be paid"
- Different meanings = different contexts

**Q2.2**: Who owns the **Approval Rules**? Is this:
- Part of Payor Context (payor configures their own rules)?
- Separate Workflow Context (reusable workflow engine)?
- Part of Receivables Context (approval is part of invoice lifecycle)?

**Q2.3**: The **Payor** concept - is it:
- Just a profile/organization (Payor Context)?
- Or does it also include the users and permissions (Identity Context)?
- Or both aspects in one context?

**Q2.4**: **Bank Accounts** - which context owns them?
- Payor Context (payor's accounts they manage)?
- Payment Context (accounts used for debits)?
- Banking Integration Context (accounts in core banking system)?

---

## Section 2: Aggregate and Entity Questions

### C. Key Domain Objects

I need to understand the identity and lifecycle of core objects:

**Questions:**

**Q3.1**: **Invoice** - What makes an invoice unique?
- Invoice ID generated by your system?
- Combination of receivable customer + invoice number?
- Something else?

**Q3.2**: **Invoice Lifecycle** - What are the states?
- Draft â†’ Sent â†’ Pending Approval â†’ Approved â†’ Submitted for Payment â†’ Paid â†’ ? 
- Can invoices be rejected? Cancelled? Partially paid?

**Q3.3**: **Payment** - Is a Payment:
- One invoice â†’ one payment?
- Multiple invoices â†’ one ACH file â†’ multiple payments?
- How do you model the relationship?

**Q3.4**: **Approval** - Is an Approval:
- An entity with its own lifecycle (Created â†’ Pending â†’ Approved/Rejected)?
- Or just a status on the Invoice?
- Can one invoice have multiple approvals (approval chain)?

**Q3.5**: **Payor vs Payor Organization**:
- Is "Payor" the organization (company)?
- Are "Payor Users" separate entities?
- Or is Payor an aggregate containing users?

---

### D. Consistency Boundaries (Aggregates)

**Questions:**

**Q4.1**: **Invoice Aggregate** - What must be consistent when an invoice changes?
- Just the invoice itself?
- Invoice + all its line items?
- Invoice + approval status?
- Invoice + payment status?

**Q4.2**: **Payor Aggregate** - What must be updated together?
- Payor profile + bank accounts?
- Payor + users + permissions?
- Or are these separate aggregates?

**Q4.3**: **Approval Rules** - When a payor changes approval rules:
- Does this affect existing pending invoices?
- Or only new invoices?
- This affects consistency boundaries!

**Q4.4**: **ACH Payment Batch** - When generating ACH file:
- Do you lock all invoices being paid (one big transaction)?
- Or is each invoice payment independent?
- What happens if ACH file fails - do you need to rollback invoice status?

---

## Section 3: Business Rules and Invariants

### E. Critical Business Rules

**Questions:**

**Q5.1**: **Invoice Approval Rules** - What are the invariants?
- "Invoice cannot be paid unless approved"?
- "Invoice cannot be modified after sent to payor"?
- "Approval tier determined by invoice amount"?

**Q5.2**: **Payment Processing Rules**:
- "Cannot create ACH file with unapproved invoices"?
- "Cannot resubmit payment until previous attempt is resolved"?
- "Payment amount must match approved invoice amount"?

**Q5.3**: **Payor Account Rules**:
- "Payor must have at least one active bank account"?
- "Cannot delete account if pending payments exist"?
- "Account must be verified before first use"?

**Q5.4**: **User Permission Rules**:
- "Only payor admin can manage users"?
- "Approver cannot approve their own submitted invoices"?
- "Second approver must be different from first approver"?

---

## Section 4: Integration and Context Mapping

### F. External System Integration

**Questions:**

**Q6.1**: **Existing Online Banking** - How does integration work?
- Is receivable customer UI truly an "extension" (embedded iframe)?
- Or separate app with SSO to banking?
- What data flows between systems?

**Q6.2**: **Okta Integration** - Does Okta:
- Only handle authentication (you manage authorization)?
- Handle both authentication AND authorization?
- Store user profiles, or do you sync to your database?

**Q6.3**: **ACH Processing** - Who handles ACH?
- Bank's core payment processor (external system)?
- Third-party ACH gateway?
- How do you receive return notifications?

**Q6.4**: **Core Banking System** - Does it:
- Store customer account information you reference?
- Validate that receivable customers are real bank customers?
- Own the "customer" entity (you just reference by ID)?

---

## Section 5: Workflow and Process

### G. Cross-Context Processes

**Questions:**

**Q7.1**: **Invoice Approval Process** - Walk me through the steps:
1. Receivable customer creates/uploads invoice
2. Sends to payor
3. Payor receives notification (which system sends it?)
4. Payor user approves (triggers what?)
5. If second approval needed, who determines this?
6. After final approval, what happens next?

**Q7.2**: **Payment Submission Process**:
1. Receivable customer selects approved invoices
2. System generates ACH file (which context does this?)
3. File submitted where? (payment processor?)
4. Status tracking - how do updates flow back?

**Q7.3**: **ACH Return Process**:
1. Return notification received from where?
2. Payment status updated (which context?)
3. Invoice status updated? (different context?)
4. Receivable customer notified?
5. Resubmission - new payment or modify existing?

---

## Section 6: Future Considerations

### H. Scalability and Evolution

**Questions:**

**Q8.1**: **Multiple Payment Methods** - Future vision includes:
- Real-time payments (Lynx)
- Credit cards
- Wire transfers
- How would this affect your domain model? (Separate bounded context for each payment type?)

**Q8.2**: **International Expansion**:
- Multi-currency support
- Different payment rails per country
- Would you have country-specific bounded contexts?

**Q8.3**: **Reporting and Analytics**:
- Is this a separate bounded context?
- Or does it query multiple contexts?
- Eventual consistency OK for reports?

---

## Priority Questions

If you can only answer a few to get started, these are most critical:

**ðŸ”´ Critical:**
1. Q1.1 - Domain classification (which is core?)
2. Q2.1 - Does "Invoice" mean the same everywhere?
3. Q4.1 - Invoice aggregate boundaries
4. Q7.1 - Invoice approval process flow

**ðŸŸ¡ Important:**
1. Q2.2 - Who owns approval rules?
2. Q3.2 - Invoice lifecycle states
3. Q4.4 - ACH batch transaction boundaries
4. Q6.1 - Banking integration pattern

**ðŸŸ¢ Nice to Have:**
1. Q8.1 - Future payment methods
2. Q5.4 - User permission edge cases

---

**Next Steps:**
1. Review these questions
2. Answer what you can now
3. Identify questions that need stakeholder input
4. I'll create initial project-ddd.md based on answers
5. Iterate and refine through feedback loops
